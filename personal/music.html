<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Music | Ben Boyette</title>
  <link rel="stylesheet" href="../assets/css/styles.css" />
</head>
<script>
  fetch("../assets/includes/navbar-personal.html")
    .then(response => response.text())
    .then(data => {
      document.getElementById("navbar").innerHTML = data;
    });

  fetch("../assets/includes/darkmode.html")
    .then(response => response.text())
    .then(data => {
      document.body.insertAdjacentHTML('afterbegin', data);
    });
</script>

<body>

  <!-- Password Protected Content -->
  <div id="protected-content" style="display:none;">

    <div id="navbar"></div>

    <section class="music">
      <h1>Music</h1>
      <p class="subtitle">Welcome to the private music section.</p>

      <!-- Track List -->
      <div class="track-list">
        <button onclick="loadTrack(0)">Diamond (Cinematic)</button>
        <button onclick="loadTrack(1)">Nature Ambience (32 min)</button>
        <button onclick="loadTrack(2)">Bronx Zoo Freestyle</button>
        <button onclick="loadTrack(3)">Golden Goose Freestyle</button>
        <button onclick="loadTrack(4)">Winter Storm Freestyle</button>
        <button onclick="loadTrack(5)">99 Build Freestyle</button>
      </div>

    </section>
  </div>

  <!-- ================= STICKY PLAYER ================= -->

  <div id="music-player">
    <img id="album-art" src="" alt="Album Art">

    <div class="player-header">Now Playing</div>
    <div id="track-title">Nothing Playing</div>

    <div class="time-row">
      <span id="current-time">0:00</span>
      <span id="duration">0:00</span>
    </div>

    <input type="range" id="progress" value="0" min="0" max="100">

    <div class="controls">
      <button onclick="prevTrack()">⏮</button>
      <button onclick="togglePlay()" id="play-btn">▶</button>
      <button onclick="nextTrack()">⏭</button>
    </div>

    <audio id="audio"></audio>
  </div>

  <!-- ================= SCRIPTS ================= -->

  <!-- Password -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const PASSWORD = "benbpassword";
      const input = prompt("Enter password:");

      if (input !== PASSWORD) {
        document.body.innerHTML =
          "<h2 style='text-align:center;margin-top:40vh;'>Access denied</h2>";
      } else {
        document.getElementById("protected-content").style.display = "block";
      }
    });
  </script>

  <!-- Player Script -->
  <script>
    const tracks = [
      {
        title: "Diamond (Cinematic)",
        src: "../assets/music/diamond-cinematic.mp3",
        // art: "../assets/images/default-art.jpg"
      },
      {
        title: "Nature Ambience (32 min)",
        src: "../assets/music/nature-thirty-min.mp3",
        // art: "../assets/images/default-art.jpg" commenting here bc no image for this file. same as above.
      },
      {
        title: "Bronx Zoo Freestyle",
        src: "../assets/music/Birthday Blizzard 26/01-Bronx-Zoo-Freestyle.mp3",
        art: "../assets/images/birthday-blizzard_music.jpg"
      },
      {
        title: "Golden Goose Freestyle",
        src: "../assets/music/Birthday Blizzard 26/02-Golden-Goose-Freestyle.mp3",
        art: "../assets/images/birthday-blizzard_music.jpg"
      },
      {
        title: "Winter Storm Freestyle",
        src: "../assets/music/Birthday Blizzard 26/03-Winter-Storm-Freestyle.mp3",
        art: "../assets/images/birthday-blizzard_music.jpg"
      },
      {
        title: "99 Build Freestyle",
        src: "../assets/music/Birthday Blizzard 26/04-99-Build-Freestyle.mp3",
        art: "../assets/images/birthday-blizzard_music.jpg"
      }
    ];


    let currentTrack = 0;
    const audio = document.getElementById("audio");
    const trackTitle = document.getElementById("track-title");
    const progress = document.getElementById("progress");
    const currentTimeEl = document.getElementById("current-time");
    const durationEl = document.getElementById("duration");
    const playBtn = document.getElementById("play-btn");
    const albumArt = document.getElementById("album-art");
    const player = document.getElementById("music-player");

    function loadTrack(index) {
      currentTrack = index;
      audio.src = tracks[index].src;
      trackTitle.textContent = tracks[index].title;
      albumArt.src = tracks[index].art;

      audio.play();
      playBtn.textContent = "⏸";
      player.classList.add("playing");

      trackPlay(tracks[index].title);
    }


    function togglePlay() {
      if (!audio.src) return;

      if (audio.paused) {
        audio.play();
        playBtn.textContent = "⏸";
        player.classList.add("playing");
      } else {
        audio.pause();
        playBtn.textContent = "▶";
        player.classList.remove("playing");
      }
    }


    function prevTrack() {
      currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
      loadTrack(currentTrack);
    }

    function nextTrack() {
      currentTrack = (currentTrack + 1) % tracks.length;
      loadTrack(currentTrack);
    }

    audio.addEventListener("timeupdate", () => {
      const percent = (audio.currentTime / audio.duration) * 100;
      progress.value = percent || 0;

      currentTimeEl.textContent = formatTime(audio.currentTime);
      durationEl.textContent = formatTime(audio.duration);
    });

    progress.addEventListener("input", () => {
      audio.currentTime = (progress.value / 100) * audio.duration;
    });

    audio.addEventListener("ended", () => {
      player.classList.remove("playing");
      nextTrack();
    });


    function formatTime(time) {
      if (!time) return "0:00";
      const minutes = Math.floor(time / 60);
      const seconds = Math.floor(time % 60).toString().padStart(2, "0");
      return `${minutes}:${seconds}`;
    }
  </script>

  <!-- Analytics -->
  <script>
    const page = location.pathname;
    const views = JSON.parse(localStorage.getItem("views") || "{}");
    views[page] = (views[page] || 0) + 1;
    localStorage.setItem("views", JSON.stringify(views));

    function trackPlay(track) {
      const plays = JSON.parse(localStorage.getItem("plays") || "{}");
      plays[track] = (plays[track] || 0) + 1;
      localStorage.setItem("plays", JSON.stringify(plays));
    }
  </script>

</body>

</html>